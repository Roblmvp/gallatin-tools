<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manager Dashboard â€” Gallatin CDJR</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --ink:#0C0C14;--ink2:#15151F;--surface:#F5F4F1;--card:#FFFFFF;
  --border:#E4E2DC;--border-strong:#C9C5BC;--muted:#8C897F;
  --text:#18171A;--subtext:#6A6760;
  --red:#C8102E;--red-dark:#9B0D22;--red-light:#FEF2F3;
  --gold:#C49A2A;--gold-light:#FDF9EF;
  --green:#14532D;--green-mid:#166534;--green-light:#F0FDF4;
  --blue:#1E3A8A;--blue-light:#EFF6FF;
  --purple:#7C3AED;--purple-light:#F5F3FF;
  --r:10px;--rsm:6px;
  --sh:0 1px 3px rgba(0,0,0,0.06),0 4px 20px rgba(0,0,0,0.05);
  --sh-lg:0 12px 48px rgba(0,0,0,0.14);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--surface);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;-webkit-font-smoothing:antialiased;}

/* LOGIN */
#login-screen{position:fixed;inset:0;background:var(--ink);display:flex;align-items:center;justify-content:center;z-index:1000;overflow:hidden;}
#login-screen::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 50% 40%,rgba(200,16,46,0.12) 0%,transparent 70%);pointer-events:none;}
.login-box{background:var(--ink2);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:48px 44px;width:100%;max-width:420px;position:relative;box-shadow:var(--sh-lg);animation:fadeUp 0.5s ease both;}
.login-box::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--red),var(--gold));border-radius:16px 16px 0 0;}
.login-logo{display:flex;align-items:center;justify-content:center;margin-bottom:32px;}
.login-logo-pill{background:#fff;border-radius:8px;padding:10px 20px;box-shadow:0 2px 12px rgba(0,0,0,0.3);}
.login-logo-pill img{height:36px;width:auto;object-fit:contain;}
.login-title{font-family:'DM Serif Display',serif;font-size:26px;color:#fff;text-align:center;line-height:1.2;margin-bottom:6px;}
.login-sub{font-size:12px;color:rgba(255,255,255,0.35);text-align:center;letter-spacing:0.1em;text-transform:uppercase;margin-bottom:36px;}
.login-field{margin-bottom:18px;}
.login-label{font-size:10px;font-weight:600;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.4);display:block;margin-bottom:8px;}
.login-input{width:100%;background:rgba(255,255,255,0.06);border:1.5px solid rgba(255,255,255,0.1);border-radius:var(--rsm);color:#fff;font-family:'DM Sans',sans-serif;font-size:15px;padding:13px 16px;outline:none;transition:border-color 0.18s,background 0.18s;-webkit-appearance:none;}
.login-input:focus{border-color:var(--red);background:rgba(255,255,255,0.09);}
.login-input::placeholder{color:rgba(255,255,255,0.2);}
.login-btn{width:100%;background:var(--red);color:#fff;border:none;border-radius:var(--rsm);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;letter-spacing:0.06em;padding:14px;cursor:pointer;margin-top:8px;transition:background 0.18s,box-shadow 0.18s,transform 0.1s;box-shadow:0 2px 12px rgba(200,16,46,0.3);}
.login-btn:hover{background:var(--red-dark);}
.login-btn:active{transform:scale(0.98);}
.login-btn:disabled{opacity:0.6;cursor:not-allowed;}
.login-error{background:rgba(200,16,46,0.15);border:1px solid rgba(200,16,46,0.3);color:#FCA5A5;border-radius:var(--rsm);padding:10px 14px;font-size:12px;font-weight:500;margin-top:14px;text-align:center;display:none;}
.login-error.show{display:block;}

/* APP */
#app{display:none;}
#app.visible{display:block;}

/* HEADER */
.header{background:var(--ink);padding:0 36px;display:grid;grid-template-columns:auto 1fr auto;align-items:center;height:72px;position:sticky;top:0;z-index:100;gap:20px;overflow:hidden;}
.header::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--red),var(--gold));}
.header-logo-pill{background:#fff;border-radius:7px;padding:7px 14px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px rgba(0,0,0,0.25);}
.header-logo-pill img{height:32px;width:auto;object-fit:contain;}
.header-center{display:flex;flex-direction:column;align-items:center;gap:3px;}
.header-title{font-family:'DM Serif Display',serif;font-size:15px;color:#fff;letter-spacing:0.03em;}
.header-pill{font-size:9px;font-weight:600;letter-spacing:0.18em;text-transform:uppercase;color:rgba(255,255,255,0.38);padding:3px 12px;border:1px solid rgba(255,255,255,0.1);border-radius:20px;}
.header-right{display:flex;align-items:center;gap:12px;}
.header-clock{text-align:right;}
.header-date{font-size:11px;color:rgba(255,255,255,0.45);}
.header-time{font-family:'DM Serif Display',serif;font-size:18px;color:#fff;}
.logout-btn{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.12);border-radius:var(--rsm);font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;letter-spacing:0.06em;padding:7px 14px;cursor:pointer;transition:all 0.18s;}
.logout-btn:hover{background:rgba(200,16,46,0.2);color:#fff;border-color:rgba(200,16,46,0.4);}

/* HERO BAND */
.hero-band{background:#EDECEA;border-bottom:1px solid var(--border);padding:12px 36px;display:flex;align-items:center;justify-content:space-between;gap:20px;}
.hero-logos{display:flex;align-items:center;gap:14px;}
.hero-logo-pill{background:#fff;border:1px solid var(--border);border-radius:8px;padding:8px 16px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 4px rgba(0,0,0,0.06);}
.hero-logo-pill img{height:30px;width:auto;object-fit:contain;}
.hero-div{width:1px;height:26px;background:var(--border-strong);}
.hero-tagline{font-size:10px;font-weight:600;letter-spacing:0.14em;text-transform:uppercase;color:var(--muted);text-align:right;}
.hero-tagline span{display:block;font-family:'DM Serif Display',serif;font-size:14px;letter-spacing:0.02em;text-transform:none;color:var(--text);margin-top:2px;}

/* NAV */
.nav-wrap{background:var(--card);border-bottom:1px solid var(--border);padding:0 36px;display:flex;overflow-x:auto;scrollbar-width:none;}
.nav-wrap::-webkit-scrollbar{display:none;}
.nav-tab{display:flex;align-items:center;gap:7px;padding:13px 20px 13px 0;font-size:11px;font-weight:600;letter-spacing:0.09em;text-transform:uppercase;color:var(--muted);border-bottom:2px solid transparent;white-space:nowrap;cursor:pointer;transition:all 0.18s;}
.nav-tab:hover{color:var(--text);}
.nav-tab.active{color:var(--red);border-bottom-color:var(--red);}

/* SYNC BAR */
.sync-bar{background:var(--blue-light);border-bottom:1px solid #BFDBFE;padding:8px 36px;display:flex;align-items:center;justify-content:space-between;gap:12px;font-size:12px;color:var(--blue);}
.sync-bar.error{background:var(--red-light);border-color:#FECACA;color:var(--red);}
.sync-bar.success{background:var(--green-light);border-color:#BBF7D0;color:var(--green-mid);}
.sync-dot{width:7px;height:7px;border-radius:50%;background:currentColor;animation:pulse 1.4s ease infinite;flex-shrink:0;}
.sync-btn{background:transparent;border:1.5px solid currentColor;border-radius:var(--rsm);font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;letter-spacing:0.06em;padding:5px 14px;cursor:pointer;color:inherit;transition:all 0.18s;}
.sync-btn:hover{opacity:0.75;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.3;}}

/* PAGE */
.page{max-width:1200px;margin:0 auto;padding:32px 24px 80px;}

/* SECTION HEAD */
.sh{display:flex;align-items:flex-end;justify-content:space-between;margin:32px 0 14px;}
.sh:first-child{margin-top:0;}
.sh-title{font-family:'DM Serif Display',serif;font-size:22px;color:var(--text);line-height:1;}
.sh-desc{font-size:12px;color:var(--muted);margin-top:4px;}
.sh-right{display:flex;align-items:center;gap:10px;flex-shrink:0;}

/* KPI */
.kpi-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-bottom:28px;}
.kpi-tile{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px 20px 18px;box-shadow:var(--sh);position:relative;overflow:hidden;transition:transform 0.18s,box-shadow 0.18s;}
.kpi-tile:hover{transform:translateY(-2px);box-shadow:var(--sh-lg);}
.kpi-tile::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.k-ink::before{background:var(--ink);}
.k-green::before{background:var(--green-mid);}
.k-blue::before{background:var(--blue);}
.k-gold::before{background:var(--gold);}
.k-red::before{background:var(--red);}
.k-purple::before{background:var(--purple);}
.kpi-label{font-size:9px;font-weight:600;letter-spacing:0.16em;text-transform:uppercase;color:var(--muted);margin-bottom:10px;}
.kpi-val{font-family:'DM Serif Display',serif;font-size:34px;color:var(--text);line-height:1;}
.k-green .kpi-val{color:var(--green-mid);}
.k-blue .kpi-val{color:var(--blue);}
.k-gold .kpi-val{color:var(--gold);}
.k-red .kpi-val{color:var(--red);}
.k-purple .kpi-val{color:var(--purple);}
.kpi-sub{font-size:11px;color:var(--muted);margin-top:6px;}

/* CARDS */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:24px 26px;box-shadow:var(--sh);margin-bottom:14px;}
.card-title{font-family:'DM Serif Display',serif;font-size:18px;margin-bottom:18px;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;}

/* TABLE */
.tbl-wrap{overflow-x:auto;border-radius:var(--rsm);border:1px solid var(--border);}
table{width:100%;border-collapse:collapse;font-size:12px;}
thead tr{background:var(--ink);}
thead th{padding:10px 14px;text-align:left;font-size:9px;font-weight:600;letter-spacing:0.12em;text-transform:uppercase;color:rgba(255,255,255,0.7);white-space:nowrap;}
tbody tr{border-bottom:1px solid var(--border);transition:background 0.12s;}
tbody tr:hover{background:rgba(200,16,46,0.03);}
tbody tr:nth-child(even){background:#FAFAF8;}
td{padding:10px 14px;color:var(--text);font-size:12px;white-space:nowrap;}
td.wrap{white-space:normal;min-width:180px;max-width:280px;}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:600;white-space:nowrap;}
.b-green{background:var(--green-light);color:var(--green-mid);}
.b-blue{background:var(--blue-light);color:var(--blue);}
.b-gold{background:var(--gold-light);color:#92400E;}
.b-red{background:var(--red-light);color:var(--red);}
.b-gray{background:#F0EEEB;color:var(--muted);}
.temp{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;font-size:12px;font-weight:700;}
.t-hot{background:var(--green-light);color:var(--green-mid);}
.t-warm{background:var(--blue-light);color:var(--blue);}
.t-luke{background:var(--gold-light);color:#92400E;}
.t-cold{background:var(--red-light);color:var(--red);}

/* REP CARDS */
.rep-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;}
.rep-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px;box-shadow:var(--sh);position:relative;overflow:hidden;}
.rep-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;}
.rc-gold::before{background:var(--gold);}
.rc-red::before{background:var(--red);}
.rc-blue::before{background:var(--blue);}
.rc-green::before{background:var(--green-mid);}
.rep-name{font-family:'DM Serif Display',serif;font-size:18px;margin-bottom:2px;}
.rep-role{font-size:10px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:16px;}
.rep-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.rep-stat{background:var(--surface);border-radius:var(--rsm);padding:10px 12px;}
.rep-stat-val{font-family:'DM Serif Display',serif;font-size:22px;line-height:1;}
.rep-stat-lbl{font-size:9px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-top:3px;}
.rc-gold .rep-stat-val{color:var(--gold);}
.rc-red .rep-stat-val{color:var(--red);}
.rc-blue .rep-stat-val{color:var(--blue);}
.rc-green .rep-stat-val{color:var(--green-mid);}

/* BARS */
.bar-wrap{display:flex;flex-direction:column;gap:9px;}
.bar-row{display:flex;align-items:center;gap:10px;}
.bar-label{font-size:11px;color:var(--subtext);width:190px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.bar-track{flex:1;background:var(--surface);border-radius:4px;height:8px;overflow:hidden;}
.bar-fill{height:100%;border-radius:4px;transition:width 0.8s ease;}
.bar-count{font-size:11px;font-weight:600;color:var(--text);width:24px;text-align:right;flex-shrink:0;}

/* FILTER BAR */
.filter-bar{display:flex;align-items:center;gap:10px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px 20px;box-shadow:var(--sh);margin-bottom:14px;flex-wrap:wrap;}
.filter-label{font-size:11px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--muted);}
.filter-input{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--rsm);color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;padding:8px 13px;outline:none;transition:border-color 0.18s;-webkit-appearance:none;}
.filter-input:focus{border-color:var(--red);}
.filter-input::placeholder{color:#C2BFB9;}
select.filter-input{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath fill='%238C897F' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px;cursor:pointer;}

/* BTNS */
.btn-dark{background:var(--ink);color:#fff;border:none;border-radius:var(--rsm);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:0.06em;padding:9px 20px;cursor:pointer;transition:background 0.18s;display:inline-flex;align-items:center;gap:6px;}
.btn-dark:hover{background:var(--ink2);}
.btn-outline-red{background:transparent;color:var(--red);border:1.5px solid var(--red);border-radius:var(--rsm);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:0.06em;padding:9px 20px;cursor:pointer;transition:all 0.18s;}
.btn-outline-red:hover{background:var(--red-light);}

/* TAB PANELS */
.tab-panel{display:none;}
.tab-panel.active{display:block;}

/* EMPTY */
.empty{text-align:center;padding:60px 20px;color:var(--muted);}
.empty-icon{font-size:40px;margin-bottom:12px;}
.empty-title{font-family:'DM Serif Display',serif;font-size:20px;color:var(--subtext);margin-bottom:6px;}

/* LOADING */
.loading{text-align:center;padding:40px;color:var(--muted);font-size:13px;}
.spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--red);border-radius:50%;animation:spin 0.7s linear infinite;margin-right:8px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg);}}

/* FOOTER */
.footer{background:var(--card);border-top:1px solid var(--border);padding:20px 36px;display:flex;align-items:center;justify-content:space-between;gap:20px;flex-wrap:wrap;}

/* ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.kpi-tile{animation:fadeUp 0.4s ease both;}
.kpi-tile:nth-child(1){animation-delay:.05s}
.kpi-tile:nth-child(2){animation-delay:.10s}
.kpi-tile:nth-child(3){animation-delay:.15s}
.kpi-tile:nth-child(4){animation-delay:.20s}
.kpi-tile:nth-child(5){animation-delay:.25s}
.kpi-tile:nth-child(6){animation-delay:.30s}

@media(max-width:900px){
  .kpi-grid{grid-template-columns:repeat(3,1fr);}
  .rep-grid{grid-template-columns:repeat(2,1fr);}
  .grid-2,.grid-3{grid-template-columns:1fr;}
  .header{padding:0 18px;grid-template-columns:auto 1fr;}
  .header-center{display:none;}
  .page{padding:20px 16px 60px;}
  .sync-bar{padding:8px 18px;}
  .nav-wrap{padding:0 18px;}
  .hero-band{padding:12px 18px;}
}
@media(max-width:560px){
  .kpi-grid{grid-template-columns:repeat(2,1fr);}
  .rep-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-pill">
        <img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868303/TAA062407W-GallatinLogos-Web-CDJR-2_yn1fwh.png" alt="Gallatin CDJR">
      </div>
    </div>
    <div class="login-title">Manager Dashboard</div>
    <div class="login-sub">Service Drive Operations Â· Restricted Access</div>
    <div class="login-field">
      <label class="login-label">Username</label>
      <input class="login-input" type="text" id="login-user" placeholder="Enter username" autocomplete="username">
    </div>
    <div class="login-field">
      <label class="login-label">Password</label>
      <input class="login-input" type="password" id="login-pass" placeholder="Enter password" autocomplete="current-password">
    </div>
    <button class="login-btn" id="login-btn" onclick="doLogin()">Sign In â†’</button>
    <div class="login-error" id="login-err">Incorrect username or password.</div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <header class="header">
    <div class="header-logo-pill">
      <img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868303/TAA062407W-GallatinLogos-Web-CDJR-2_yn1fwh.png" alt="Gallatin CDJR">
    </div>
    <div class="header-center">
      <div class="header-title">Manager Dashboard</div>
      <div class="header-pill">Service Drive Operations</div>
    </div>
    <div class="header-right">
      <div class="header-clock">
        <div class="header-date" id="hdr-date"></div>
        <div class="header-time" id="hdr-time"></div>
      </div>
      <button class="logout-btn" onclick="doLogout()">Sign Out</button>
    </div>
  </header>

  <div class="hero-band">
    <div class="hero-logos">
      <div class="hero-logo-pill"><img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868289/WE_Auto_Badge_1_f5djzq.png" alt="WeAuto"></div>
      <div class="hero-div"></div>
      <div class="hero-logo-pill"><img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868289/MSG-CDJR_cfgryx.png" alt="Worry Free"></div>
    </div>
    <div class="hero-tagline">WeAuto Dealer Group<span>Gallatin, Tennessee</span></div>
  </div>

  <div id="sync-bar" class="sync-bar">
    <div style="display:flex;align-items:center;gap:8px;">
      <div class="sync-dot"></div>
      <span id="sync-msg">Connecting to database...</span>
    </div>
    <button class="sync-btn" onclick="loadAll()">â†» Refresh</button>
  </div>

  <div class="nav-wrap">
    <div class="nav-tab active" id="nt-overview"  onclick="showTab('overview',this)">ğŸ“Š Overview</div>
    <div class="nav-tab" id="nt-entries"   onclick="showTab('entries',this)">ğŸ“‹ All Entries</div>
    <div class="nav-tab" id="nt-pipeline"  onclick="showTab('pipeline',this)">ğŸ“† Follow-Up Pipeline</div>
    <div class="nav-tab" id="nt-reps"      onclick="showTab('reps',this)">ğŸ‘¤ Rep Scorecards</div>
    <div class="nav-tab" id="nt-triggers"  onclick="showTab('triggers',this)">ğŸ”§ Service Triggers</div>
  </div>

  <div class="page">

    <!-- OVERVIEW -->
    <div class="tab-panel active" id="tab-overview">
      <div class="sh">
        <div><div class="sh-title">Team Overview</div><div class="sh-desc">Live data from all S2S form submissions</div></div>
        <div class="sh-right"><span id="last-sync" style="font-size:11px;color:var(--muted);"></span></div>
      </div>
      <div class="kpi-grid">
        <div class="kpi-tile k-ink"><div class="kpi-label">Total Entries</div><div class="kpi-val" id="kpi-total">â€”</div><div class="kpi-sub">All time</div></div>
        <div class="kpi-tile k-green"><div class="kpi-label">Vehicles Sold</div><div class="kpi-val" id="kpi-sold">â€”</div><div class="kpi-sub">New + used</div></div>
        <div class="kpi-tile k-blue"><div class="kpi-label">Appts Set</div><div class="kpi-val" id="kpi-appts">â€”</div><div class="kpi-sub">Scheduled</div></div>
        <div class="kpi-tile k-gold"><div class="kpi-label">Open Follow-Ups</div><div class="kpi-val" id="kpi-followups">â€”</div><div class="kpi-sub">Need action</div></div>
        <div class="kpi-tile k-red"><div class="kpi-label">Conversion Rate</div><div class="kpi-val" id="kpi-conv">â€”</div><div class="kpi-sub">Entries â†’ sales</div></div>
        <div class="kpi-tile k-purple"><div class="kpi-label">Avg Buy Temp</div><div class="kpi-val" id="kpi-temp">â€”</div><div class="kpi-sub">Out of 10</div></div>
      </div>
      <div class="grid-2">
        <div class="card"><div class="card-title">Outcome Breakdown</div><div class="bar-wrap" id="outcome-bars"><div class="loading"><span class="spinner"></span>Loading...</div></div></div>
        <div class="card"><div class="card-title">Buying Temperature</div><div class="bar-wrap" id="temp-bars"><div class="loading"><span class="spinner"></span>Loading...</div></div></div>
      </div>
      <div class="grid-2" style="margin-top:14px;">
        <div class="card"><div class="card-title">Equity Position Breakdown</div><div class="bar-wrap" id="equity-bars"><div class="loading"><span class="spinner"></span>Loading...</div></div></div>
        <div class="card"><div class="card-title">Customer Contact Preference</div><div class="bar-wrap" id="contact-bars"><div class="loading"><span class="spinner"></span>Loading...</div></div></div>
      </div>
    </div>

    <!-- ALL ENTRIES -->
    <div class="tab-panel" id="tab-entries">
      <div class="sh">
        <div><div class="sh-title">All S2S Entries</div><div class="sh-desc">Complete log of every form submission</div></div>
        <div class="sh-right">
          <button class="btn-dark" onclick="exportCSV()">â¬‡ Export CSV</button>
          <button class="btn-outline-red" onclick="confirmDelete()">âœ• Clear All</button>
        </div>
      </div>
      <div class="filter-bar">
        <span class="filter-label">Filter:</span>
        <input class="filter-input" type="text" id="search-input" placeholder="Search name, vehicle, notes..." style="width:220px;" oninput="renderEntries()">
        <select class="filter-input" id="filter-rep" onchange="renderEntries()">
          <option value="">All Reps</option>
          <option>Tyler Doyle</option><option>Andrew Kirk</option><option>DJ Rogers</option><option>Kody McCann</option>
        </select>
        <select class="filter-input" id="filter-outcome" onchange="renderEntries()">
          <option value="">All Outcomes</option>
          <option>New Vehicle Sold</option><option>Used Vehicle Sold</option>
          <option>Appointment Set</option><option>Follow-Up Required</option><option>Not Interested</option>
        </select>
        <select class="filter-input" id="filter-temp" onchange="renderEntries()">
          <option value="">All Temps</option>
          <option value="hot">Hot (8-10)</option>
          <option value="warm">Warm (5-7)</option>
          <option value="cold">Cold (1-4)</option>
        </select>
      </div>
      <div class="tbl-wrap">
        <table>
          <thead><tr>
            <th>#</th><th>Date/Time</th><th>By</th><th>Customer</th><th>Phone</th>
            <th>Vehicle</th><th>Miles</th><th>Visit Reason</th><th>Repair $</th>
            <th>Emotion</th><th>Temp</th><th>Outcome</th><th>Salesperson</th>
            <th>Follow-Up</th><th>Notes</th>
          </tr></thead>
          <tbody id="entries-tbody"><tr><td colspan="15"><div class="loading"><span class="spinner"></span>Loading entries...</div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- PIPELINE -->
    <div class="tab-panel" id="tab-pipeline">
      <div class="sh"><div><div class="sh-title">Follow-Up Pipeline</div><div class="sh-desc">Open follow-ups and appointments â€” sorted by date. Red = overdue.</div></div></div>
      <div class="tbl-wrap">
        <table>
          <thead><tr>
            <th>Customer</th><th>Phone</th><th>Salesperson</th><th>Vehicle of Interest</th>
            <th>Temp</th><th>Follow-Up Date</th><th>Via</th><th>Equity</th><th>Timeline</th><th>Notes</th>
          </tr></thead>
          <tbody id="pipeline-tbody"><tr><td colspan="10"><div class="loading"><span class="spinner"></span>Loading...</div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- REP SCORECARDS -->
    <div class="tab-panel" id="tab-reps">
      <div class="sh"><div><div class="sh-title">Rep Scorecards</div><div class="sh-desc">Individual performance metrics per salesperson</div></div></div>
      <div class="rep-grid" id="rep-grid"><div class="loading"><span class="spinner"></span>Loading...</div></div>
    </div>

    <!-- SERVICE TRIGGERS -->
    <div class="tab-panel" id="tab-triggers">
      <div class="sh"><div><div class="sh-title">Service Trigger Analysis</div><div class="sh-desc">Which repair types generate the most conversions</div></div></div>
      <div class="card">
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>Visit Reason</th><th>Contacts</th><th>Appts</th><th>Sold</th><th>Not Int.</th><th>Conv. %</th><th>Avg Temp</th></tr></thead>
            <tbody id="triggers-tbody"><tr><td colspan="7"><div class="loading"><span class="spinner"></span>Loading...</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /page -->

  <footer class="footer">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="hero-logo-pill"><img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868289/WE_Auto_Badge_1_f5djzq.png" alt="WeAuto" style="height:24px;"></div>
      <div style="width:1px;height:20px;background:var(--border-strong);"></div>
      <div class="hero-logo-pill"><img src="https://res.cloudinary.com/di5ujiwjp/image/upload/v1769868289/MSG-CDJR_cfgryx.png" alt="Worry Free" style="height:24px;"></div>
    </div>
    <div style="font-size:11px;color:var(--muted);text-align:right;line-height:1.8;">
      <strong style="color:var(--subtext);">Gallatin Chrysler Dodge Jeep Ram</strong><br>
      WeAuto Dealer Group Â· Manager Access Only Â· Confidential
    </div>
  </footer>
</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUPABASE CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SB_URL  = 'https://jbkgwtohwsbaorhvuuqb.supabase.co';
const SB_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impia2d3dG9od3NiYW9yaHZ1dXFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NjkwNDIsImV4cCI6MjA4NzU0NTA0Mn0.GRXOYbIuVDxU9-FEBYmyd1QmytVUrMIAxbnOSfepzuU';
const HEADERS = { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY, 'Content-Type': 'application/json' };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREDENTIALS â€” change these any time
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const USERS = { 'robert': 'gcdjr2025', 'tyler': 'manager2025' };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL DATA STORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ALL_ENTRIES = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const u = document.getElementById('login-user').value.trim().toLowerCase();
  const p = document.getElementById('login-pass').value;
  const btn = document.getElementById('login-btn');
  if(USERS[u] && USERS[u] === p){
    sessionStorage.setItem('mgr_auth','1');
    document.getElementById('login-screen').style.display='none';
    document.getElementById('app').classList.add('visible');
    loadAll();
  } else {
    document.getElementById('login-err').classList.add('show');
    btn.textContent = 'Try Again';
    setTimeout(()=>{ btn.textContent='Sign In â†’'; },2000);
  }
}
function doLogout(){ sessionStorage.removeItem('mgr_auth'); location.reload(); }
document.addEventListener('keydown',e=>{ if(e.key==='Enter'&&document.getElementById('login-screen').style.display!=='none') doLogin(); });
if(sessionStorage.getItem('mgr_auth')==='1'){
  document.getElementById('login-screen').style.display='none';
  document.getElementById('app').classList.add('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tick(){
  const n=new Date(),mo=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],da=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const d=document.getElementById('hdr-date'),t=document.getElementById('hdr-time');
  if(d) d.textContent=`${da[n.getDay()]}, ${mo[n.getMonth()]} ${n.getDate()}`;
  if(t) t.textContent=n.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true})+' CT';
}
tick(); setInterval(tick,1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUPABASE FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAll(){
  setSyncBar('loading','Syncing with database...');
  try {
    const res = await fetch(`${SB_URL}/rest/v1/s2s_entries?select=*&order=id.desc&limit=1000`, { headers: HEADERS });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    ALL_ENTRIES = await res.json();
    setSyncBar('success', `Synced â€” ${ALL_ENTRIES.length} entries loaded Â· ${new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true})}`);
    document.getElementById('last-sync').textContent = `Last synced: ${new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true})}`;
    renderAll();
  } catch(err){
    setSyncBar('error', `Connection error: ${err.message} â€” check Supabase table exists`);
    console.error('Supabase error:', err);
  }
}

function setSyncBar(type, msg){
  const bar = document.getElementById('sync-bar');
  const msgEl = document.getElementById('sync-msg');
  bar.className = 'sync-bar' + (type==='error'?' error':type==='success'?' success':'');
  msgEl.textContent = msg;
}

// Auto-refresh every 60 seconds
setInterval(()=>{ if(sessionStorage.getItem('mgr_auth')==='1') loadAll(); }, 60000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll(){
  renderOverview();
  renderEntries();
  renderPipeline();
  renderReps();
  renderTriggers();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OVERVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderOverview(){
  const e = ALL_ENTRIES;
  const n = e.length;
  const sold = e.filter(x=>x.outcome&&(x.outcome.includes('New Vehicle')||x.outcome.includes('Used Vehicle'))).length;
  const appts = e.filter(x=>x.outcome==='Appointment Set').length;
  const fu = e.filter(x=>x.outcome==='Follow-Up Required').length;
  const conv = n>0?Math.round((sold/n)*100):0;
  const temps = e.map(x=>parseInt(x.eng_score)).filter(t=>!isNaN(t));
  const avgT = temps.length>0?(temps.reduce((a,b)=>a+b,0)/temps.length).toFixed(1):'â€”';

  document.getElementById('kpi-total').textContent=n;
  document.getElementById('kpi-sold').textContent=sold;
  document.getElementById('kpi-appts').textContent=appts;
  document.getElementById('kpi-followups').textContent=fu;
  document.getElementById('kpi-conv').textContent=conv+'%';
  document.getElementById('kpi-temp').textContent=avgT;

  // Outcome bars
  const outcomes=[['New Vehicle Sold','#166534'],['Used Vehicle Sold','#14532D'],['Appointment Set','#1E3A8A'],['Follow-Up Required','#C49A2A'],['Not Interested','#C8102E']];
  const oc=outcomes.map(([o])=>e.filter(x=>x.outcome===o).length);
  const mxo=Math.max(...oc,1);
  document.getElementById('outcome-bars').innerHTML=outcomes.map(([o,c],i)=>`
    <div class="bar-row"><div class="bar-label" title="${o}">${o}</div>
    <div class="bar-track"><div class="bar-fill" style="width:${(oc[i]/mxo*100).toFixed(1)}%;background:${c};"></div></div>
    <div class="bar-count">${oc[i]}</div></div>`).join('');

  // Temp bars
  const tg=[['ğŸ”¥ Hot (8â€“10)',8,10,'#166534'],['ğŸŒ¡ Warm (5â€“7)',5,7,'#1E3A8A'],['ğŸŒ¤ Lukewarm (3â€“4)',3,4,'#C49A2A'],['â„ï¸ Cold (1â€“2)',1,2,'#C8102E']];
  const tc=tg.map(([,mn,mx])=>e.filter(x=>{const t=parseInt(x.eng_score);return !isNaN(t)&&t>=mn&&t<=mx;}).length);
  const mxt=Math.max(...tc,1);
  document.getElementById('temp-bars').innerHTML=tg.map(([l,,,,c],i)=>`
    <div class="bar-row"><div class="bar-label">${tg[i][0]}</div>
    <div class="bar-track"><div class="bar-fill" style="width:${(tc[i]/mxt*100).toFixed(1)}%;background:${tg[i][3]};"></div></div>
    <div class="bar-count">${tc[i]}</div></div>`).join('');

  // Equity
  const eq=[['Positive Equity','#166534'],['At or Near Breakeven','#C49A2A'],['Negative Equity (Upside Down)','#C8102E'],['Unknown / Not Disclosed','#8C897F']];
  const eqc=eq.map(([v])=>e.filter(x=>x.trade_equity===v).length);
  const mxe=Math.max(...eqc,1);
  document.getElementById('equity-bars').innerHTML=eq.map(([v,c],i)=>`
    <div class="bar-row"><div class="bar-label" title="${v}">${v}</div>
    <div class="bar-track"><div class="bar-fill" style="width:${(eqc[i]/mxe*100).toFixed(1)}%;background:${c};"></div></div>
    <div class="bar-count">${eqc[i]}</div></div>`).join('');

  // Contact pref
  const cp=[['Phone Call','#1E3A8A'],['Text Message','#166534'],['Email','#C49A2A'],['No Preference','#8C897F']];
  const cpc=cp.map(([v])=>e.filter(x=>x.contact_pref===v).length);
  const mxc=Math.max(...cpc,1);
  document.getElementById('contact-bars').innerHTML=cp.map(([v,c],i)=>`
    <div class="bar-row"><div class="bar-label">${v}</div>
    <div class="bar-track"><div class="bar-fill" style="width:${(cpc[i]/mxc*100).toFixed(1)}%;background:${c};"></div></div>
    <div class="bar-count">${cpc[i]}</div></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function obadge(o){
  if(!o||o==='â€”') return '<span class="badge b-gray">â€”</span>';
  if(o.includes('New Vehicle')||o.includes('Used Vehicle')) return `<span class="badge b-green">ğŸ† ${o}</span>`;
  if(o.includes('Appointment')) return `<span class="badge b-blue">ğŸ“… ${o}</span>`;
  if(o.includes('Follow-Up')) return `<span class="badge b-gold">ğŸ”” ${o}</span>`;
  if(o.includes('Not Interested')) return `<span class="badge b-red">âœ— ${o}</span>`;
  return `<span class="badge b-gray">${o}</span>`;
}
function tbadge(t){
  const n=parseInt(t);
  if(isNaN(n)||!t) return '<span class="badge b-gray">â€”</span>';
  let cls='t-cold';
  if(n>=8) cls='t-hot'; else if(n>=5) cls='t-warm'; else if(n>=3) cls='t-luke';
  return `<span class="temp ${cls}">${n}</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALL ENTRIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderEntries(){
  const search=(document.getElementById('search-input')?.value||'').toLowerCase();
  const repF=document.getElementById('filter-rep')?.value||'';
  const outF=document.getElementById('filter-outcome')?.value||'';
  const tempF=document.getElementById('filter-temp')?.value||'';
  let f=ALL_ENTRIES.filter(e=>{
    if(search&&!JSON.stringify(e).toLowerCase().includes(search)) return false;
    if(repF&&e.submitter!==repF) return false;
    if(outF&&e.outcome!==outF) return false;
    if(tempF){const t=parseInt(e.eng_score);if(tempF==='hot'&&!(t>=8))return false;if(tempF==='warm'&&!(t>=5&&t<=7))return false;if(tempF==='cold'&&!(t<=4))return false;}
    return true;
  });
  const tbody=document.getElementById('entries-tbody');
  if(!f.length){
    tbody.innerHTML=`<tr><td colspan="15"><div class="empty"><div class="empty-icon">ğŸ“‹</div><div class="empty-title">No entries found</div></div></td></tr>`;
    return;
  }
  tbody.innerHTML=f.map((e,i)=>`<tr>
    <td style="color:var(--muted);font-size:11px;">${f.length-i}</td>
    <td style="font-size:11px;color:var(--subtext);">${e.timestamp||'â€”'}</td>
    <td><span style="font-weight:600;">${e.submitter||'â€”'}</span><br><span style="font-size:10px;color:var(--muted);">${e.entry_type||''}</span></td>
    <td><strong>${e.first_name||''} ${e.last_name||''}</strong></td>
    <td>${e.phone||'â€”'}</td>
    <td>${[e.veh_year,e.veh_make,e.veh_model].filter(Boolean).join(' ')||'â€”'}</td>
    <td>${e.veh_miles?Number(e.veh_miles).toLocaleString()+' mi':'â€”'}</td>
    <td style="max-width:160px;white-space:normal;font-size:11px;">${e.visit_reason||'â€”'}</td>
    <td>${e.repair_cost||'â€”'}</td>
    <td style="font-size:11px;">${e.cust_emotion||'â€”'}</td>
    <td>${tbadge(e.eng_score)}</td>
    <td>${obadge(e.outcome)}</td>
    <td style="font-weight:600;">${e.salesperson||'â€”'}</td>
    <td style="font-size:11px;">${e.followup_date||'â€”'}</td>
    <td class="wrap" style="font-size:11px;color:var(--subtext);">${e.notes||'â€”'}</td>
  </tr>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PIPELINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPipeline(){
  let pipe=ALL_ENTRIES.filter(e=>e.outcome==='Follow-Up Required'||e.outcome==='Appointment Set');
  pipe.sort((a,b)=>{if(!a.followup_date)return 1;if(!b.followup_date)return -1;return new Date(a.followup_date)-new Date(b.followup_date);});
  const tbody=document.getElementById('pipeline-tbody');
  if(!pipe.length){
    tbody.innerHTML=`<tr><td colspan="10"><div class="empty"><div class="empty-icon">ğŸ“†</div><div class="empty-title">Pipeline is clear</div></div></td></tr>`;
    return;
  }
  const today=new Date();today.setHours(0,0,0,0);
  tbody.innerHTML=pipe.map(e=>{
    const fd=e.followup_date?new Date(e.followup_date):null;
    let ds='';
    if(fd){if(fd<today)ds='color:var(--red);font-weight:700;';else if(fd.getTime()===today.getTime())ds='color:var(--gold);font-weight:700;';}
    return `<tr>
      <td><strong>${e.first_name||''} ${e.last_name||''}</strong></td>
      <td>${e.phone||'â€”'}</td>
      <td style="font-weight:600;">${e.salesperson||'â€”'}</td>
      <td>${e.voi||'â€”'}</td>
      <td>${tbadge(e.eng_score)}</td>
      <td style="${ds}">${e.followup_date||'â€”'}</td>
      <td>${e.followup_method||'â€”'}</td>
      <td style="font-size:11px;">${e.trade_equity||'â€”'}</td>
      <td style="font-size:11px;">${e.timeline||'â€”'}</td>
      <td class="wrap" style="font-size:11px;color:var(--subtext);">${e.notes||'â€”'}</td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REP SCORECARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderReps(){
  const reps=[{name:'Tyler Doyle',role:'S2S Manager',cls:'rc-gold'},{name:'Andrew Kirk',role:'Sales',cls:'rc-red'},{name:'DJ Rogers',role:'Sales',cls:'rc-blue'},{name:'Kody McCann',role:'Sales',cls:'rc-green'}];
  document.getElementById('rep-grid').innerHTML=reps.map(rep=>{
    const re=ALL_ENTRIES.filter(e=>e.submitter===rep.name);
    const total=re.length;
    const sold=re.filter(e=>e.outcome&&(e.outcome.includes('New')||e.outcome.includes('Used'))).length;
    const appts=re.filter(e=>e.outcome==='Appointment Set').length;
    const fu=re.filter(e=>e.outcome==='Follow-Up Required').length;
    const hot=re.filter(e=>parseInt(e.eng_score)>=8).length;
    const ts=re.map(e=>parseInt(e.eng_score)).filter(t=>!isNaN(t));
    const avg=ts.length?(ts.reduce((a,b)=>a+b,0)/ts.length).toFixed(1):'â€”';
    const conv=total?Math.round((sold/total)*100)+'%':'â€”';
    return `<div class="rep-card ${rep.cls}">
      <div class="rep-name">${rep.name}</div><div class="rep-role">${rep.role}</div>
      <div class="rep-stats">
        <div class="rep-stat"><div class="rep-stat-val">${total}</div><div class="rep-stat-lbl">Entries</div></div>
        <div class="rep-stat"><div class="rep-stat-val">${sold}</div><div class="rep-stat-lbl">Sold</div></div>
        <div class="rep-stat"><div class="rep-stat-val">${appts}</div><div class="rep-stat-lbl">Appts</div></div>
        <div class="rep-stat"><div class="rep-stat-val">${fu}</div><div class="rep-stat-lbl">Follow-Ups</div></div>
        <div class="rep-stat"><div class="rep-stat-val">${hot}</div><div class="rep-stat-lbl">Hot Leads</div></div>
        <div class="rep-stat"><div class="rep-stat-val">${avg}</div><div class="rep-stat-lbl">Avg Temp</div></div>
        <div class="rep-stat" style="grid-column:1/-1;"><div class="rep-stat-val">${conv}</div><div class="rep-stat-lbl">Conversion Rate</div></div>
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SERVICE TRIGGERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTriggers(){
  const reasons=['Major Mechanical Repair','Transmission / Drivetrain','Engine Concern','High Mileage Service','Safety â€” Brakes / Suspension','Electrical / Technology Issue','Routine Maintenance (Oil, Tires, Filters)','Scheduled Service / Recall','Body / Collision','Warranty Claim','Customer Pay â€” Other'];
  const rows=reasons.map(r=>{
    const re=ALL_ENTRIES.filter(e=>e.visit_reason===r);
    const total=re.length;
    const appts=re.filter(e=>e.outcome==='Appointment Set').length;
    const sold=re.filter(e=>e.outcome&&(e.outcome.includes('New')||e.outcome.includes('Used'))).length;
    const ni=re.filter(e=>e.outcome==='Not Interested').length;
    const conv=total?((sold/total)*100).toFixed(1)+'%':'â€”';
    const ts=re.map(e=>parseInt(e.eng_score)).filter(t=>!isNaN(t));
    const avg=ts.length?(ts.reduce((a,b)=>a+b,0)/ts.length).toFixed(1):'â€”';
    return {r,total,appts,sold,ni,conv,avg};
  }).filter(x=>x.total>0).sort((a,b)=>b.total-a.total);
  const tbody=document.getElementById('triggers-tbody');
  if(!rows.length){tbody.innerHTML=`<tr><td colspan="7"><div class="empty"><div class="empty-icon">ğŸ”§</div><div class="empty-title">No data yet</div></div></td></tr>`;return;}
  tbody.innerHTML=rows.map(row=>{
    const pct=parseFloat(row.conv);
    const cc=pct>20?'var(--green-mid)':pct>10?'var(--gold)':'var(--red)';
    return `<tr>
      <td style="font-weight:600;">${row.r}</td>
      <td style="text-align:center;font-weight:700;">${row.total}</td>
      <td style="text-align:center;">${row.appts}</td>
      <td style="text-align:center;font-weight:700;color:var(--green-mid);">${row.sold}</td>
      <td style="text-align:center;color:var(--red);">${row.ni}</td>
      <td style="text-align:center;font-weight:700;color:${cc};">${row.conv}</td>
      <td style="text-align:center;">${tbadge(row.avg)}</td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT CSV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV(){
  if(!ALL_ENTRIES.length){alert('No entries to export.');return;}
  const keys=Object.keys(ALL_ENTRIES[0]);
  const header=keys.join(',');
  const rows=ALL_ENTRIES.map(e=>keys.map(k=>`"${(e[k]??'').toString().replace(/"/g,'""')}"`).join(','));
  const blob=new Blob([[header,...rows].join('\n')],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`S2S_Log_GallatinCDJR_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE ALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function confirmDelete(){
  if(!confirm('DELETE ALL S2S entries from the database? This cannot be undone.')) return;
  const code=prompt('Type CONFIRM to proceed:');
  if(code!=='CONFIRM'){alert('Cancelled.');return;}
  try{
    const res=await fetch(`${SB_URL}/rest/v1/s2s_entries?id=gte.0`,{method:'DELETE',headers:HEADERS});
    if(res.ok){alert('All entries deleted.');loadAll();}
    else throw new Error(await res.text());
  }catch(err){alert('Delete failed: '+err.message);}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(id,el){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  el.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if(sessionStorage.getItem('mgr_auth')==='1') loadAll();
</script>
</body>
</html>
